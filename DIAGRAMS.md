# FlysSeats - Visual Architecture

## System Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                         FlysSeats Platform                       │
└─────────────────────────────────────────────────────────────────┘

┌──────────────┐        ┌──────────────┐        ┌──────────────┐
│   Browser    │───────▶│  Angular App │───────▶│ Azure Web    │
│   (Web)      │        │  (Frontend)  │        │   App        │
└──────────────┘        └──────────────┘        └──────────────┘
       │                                                │
       │                                                │
       ▼                                                ▼
┌──────────────┐                              ┌──────────────┐
│  Capacitor   │                              │    Azure     │
│   Wrapper    │                              │  Functions   │
└──────────────┘                              │  (Backend)   │
       │                                      └──────────────┘
       │                                                │
       ▼                                                │
┌──────────────┐                                       │
│   Mobile     │                                       │
│  iOS/Android │◀──────────────────────────────────────┘
└──────────────┘
```

## Frontend Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                      Angular Application                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────┐    │
│  │                   App Component                         │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │    │
│  │  │  Toolbar     │  │   Language   │  │  Navigation  │ │    │
│  │  │  (Material)  │  │   Switcher   │  │    Menu      │ │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘ │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   Router Outlet                          │   │
│  │  (Lazy Loaded Routes)                                   │   │
│  │                                                          │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │   │
│  │  │    Auth      │  │   Flights    │  │   Bookings   │ │   │
│  │  │   Feature    │  │   Feature    │  │   Feature    │ │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘ │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   Core Services                          │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │   │
│  │  │    Auth      │  │   Flight     │  │   Booking    │ │   │
│  │  │   Service    │  │   Service    │  │   Service    │ │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘ │   │
│  │  ┌──────────────┐  ┌──────────────┐                   │   │
│  │  │    Cache     │  │ Translate    │                   │   │
│  │  │   Service    │  │   Service    │                   │   │
│  │  └──────────────┘  └──────────────┘                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              Guards & Interceptors                       │   │
│  │  ┌──────────────┐  ┌──────────────┐                    │   │
│  │  │    Auth      │  │     HTTP     │                    │   │
│  │  │    Guard     │  │ Interceptor  │                    │   │
│  │  └──────────────┘  └──────────────┘                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Backend Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    Azure Functions (Python)                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │    Auth      │  │   Flights    │  │   Bookings   │         │
│  │   Function   │  │   Function   │  │   Function   │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│         │                  │                  │                 │
│         ▼                  ▼                  ▼                 │
│  ┌──────────────────────────────────────────────────┐         │
│  │              HTTP Triggers                        │         │
│  │  POST /api/auth/login                            │         │
│  │  POST /api/flights/search                        │         │
│  │  GET  /api/bookings/:id?                         │         │
│  │  POST /api/bookings                              │         │
│  │  DEL  /api/bookings/:id                          │         │
│  └──────────────────────────────────────────────────┘         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Data Flow

```
┌─────────┐
│  User   │
└────┬────┘
     │
     │ 1. Interaction
     ▼
┌─────────────────┐
│   Component     │
└────┬────────────┘
     │
     │ 2. Action
     ▼
┌─────────────────┐     3. Check Cache    ┌──────────────┐
│    Service      │◀──────────────────────▶│ sessionStorage│
└────┬────────────┘                        └──────────────┘
     │
     │ 4. HTTP Request (if not cached)
     ▼
┌─────────────────┐
│  Interceptor    │───── 5. Add JWT Token
└────┬────────────┘
     │
     │ 6. API Call
     ▼
┌─────────────────┐
│ Azure Functions │
└────┬────────────┘
     │
     │ 7. Response
     ▼
┌─────────────────┐
│    Service      │───── 8. Cache Result
└────┬────────────┘
     │
     │ 9. Observable
     ▼
┌─────────────────┐
│   Component     │───── 10. Update UI
└─────────────────┘
```

## Infrastructure Topology

```
┌─────────────────────────────────────────────────────────────────┐
│                         Azure Cloud                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────┐    │
│  │              Resource Group                             │    │
│  │  (flyseats-{env}-rg)                                   │    │
│  │                                                         │    │
│  │  ┌──────────────────────────────────────────────────┐ │    │
│  │  │         App Service Plan (Web)                    │ │    │
│  │  │         SKU: B1                                   │ │    │
│  │  │  ┌────────────────────────────────────┐          │ │    │
│  │  │  │      Linux Web App                 │          │ │    │
│  │  │  │      Node.js 18 LTS                │          │ │    │
│  │  │  │      (Angular Frontend)            │          │ │    │
│  │  │  └────────────────────────────────────┘          │ │    │
│  │  └──────────────────────────────────────────────────┘ │    │
│  │                                                         │    │
│  │  ┌──────────────────────────────────────────────────┐ │    │
│  │  │       App Service Plan (Functions)               │ │    │
│  │  │       SKU: Y1 (Consumption)                      │ │    │
│  │  │  ┌────────────────────────────────────┐          │ │    │
│  │  │  │    Linux Function App              │          │ │    │
│  │  │  │    Python 3.9                      │          │ │    │
│  │  │  │    (Backend APIs)                  │          │ │    │
│  │  │  └────────────────────────────────────┘          │ │    │
│  │  └──────────────────────────────────────────────────┘ │    │
│  │                                                         │    │
│  │  ┌──────────────────────────────────────────────────┐ │    │
│  │  │         Storage Account                           │ │    │
│  │  │         (Function storage)                        │ │    │
│  │  └──────────────────────────────────────────────────┘ │    │
│  │                                                         │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## CI/CD Pipeline Flow

```
┌─────────────┐
│  Developer  │
└──────┬──────┘
       │
       │ git push
       ▼
┌─────────────────────┐
│  GitHub Repository  │
└──────┬──────────────┘
       │
       │ Trigger
       ▼
┌─────────────────────────────────────────────────────┐
│              GitHub Actions Workflows                │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────┐ │
│  │   Frontend   │  │   Backend    │  │ Terraform│ │
│  │   Pipeline   │  │   Pipeline   │  │ Pipeline │ │
│  └──────┬───────┘  └──────┬───────┘  └────┬─────┘ │
│         │                  │                │       │
└─────────┼──────────────────┼────────────────┼───────┘
          │                  │                │
          │                  │                │
          ▼                  ▼                ▼
    ┌──────────┐      ┌──────────┐    ┌──────────┐
    │   Web    │      │ Function │    │  Azure   │
    │   App    │      │   App    │    │Resources │
    └──────────┘      └──────────┘    └──────────┘
```

## Mobile Build Process

```
┌─────────────────┐
│  Angular Build  │
│  (Production)   │
└────────┬────────┘
         │
         │ npm run build
         ▼
┌─────────────────┐
│  dist/          │
│  (Web Assets)   │
└────────┬────────┘
         │
         │ cap sync
         ▼
┌─────────────────────────────────────┐
│        Capacitor Wrapper             │
├─────────────────────────────────────┤
│                                      │
│  ┌──────────────┐  ┌──────────────┐│
│  │   Android    │  │     iOS      ││
│  │   Project    │  │   Project    ││
│  └──────┬───────┘  └──────┬───────┘│
└─────────┼──────────────────┼────────┘
          │                  │
          │ Build            │ Build
          ▼                  ▼
    ┌──────────┐      ┌──────────┐
    │   APK    │      │   IPA    │
    └──────────┘      └──────────┘
```

## Security Flow

```
┌──────────┐
│   User   │
└────┬─────┘
     │
     │ 1. Login
     ▼
┌─────────────┐
│ AuthService │
└────┬────────┘
     │
     │ 2. POST /api/auth/login
     ▼
┌──────────────┐
│Auth Function │
└────┬─────────┘
     │
     │ 3. Return JWT
     ▼
┌─────────────┐
│sessionStorage│◀─── 4. Store token
└─────────────┘
     │
     │ 5. Subsequent requests
     ▼
┌──────────────────┐
│ HTTP Interceptor │◀─── 6. Auto-add token
└────┬─────────────┘
     │
     │ 7. Authenticated request
     ▼
┌──────────────┐
│Azure Function│
└──────────────┘
```

## Component Relationships

```
AppComponent
    │
    ├── MatToolbar (Navigation)
    │   ├── Menu Button
    │   ├── Language Selector
    │   └── Auth Buttons
    │
    └── RouterOutlet
        │
        ├── /auth/login
        │   └── LoginComponent (Standalone)
        │       └── Uses: AuthService
        │
        ├── /flights
        │   └── FlightSearchComponent (Standalone)
        │       └── Uses: FlightService, CacheService
        │
        └── /bookings [AuthGuard]
            └── BookingsListComponent (Standalone)
                └── Uses: BookingService, CacheService
```
